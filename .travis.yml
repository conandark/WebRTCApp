language: java
jdk:
  - openjdk8

sudo: false



#travis running on ubuntu 14.04

before_install: 
#  - openssl aes-256-cbc -K $encrypted_5fef4fa28306_key -iv $encrypted_5fef4fa28306_iv -in codesigning.asc.enc -out codesigning.asc -d
#  - gpg --fast-import codesigning.asc
  - sudo git clone --depth=1 https://github.com/ant-media/utilities.git /usr/local/onvif
  - (if [ $(git ls-remote https://github.com/ant-media/Ant-Media-Server-Common.git $TRAVIS_BRANCH  | wc -l) == "1" ];  then echo " $TRAVIS_BRANCH branch found";  git clone --depth=1 -b $TRAVIS_BRANCH https://github.com/ant-media/Ant-Media-Server-Common.git;  else echo "branch not found"; git clone --depth=1 https://github.com/ant-media/Ant-Media-Server-Common.git;  fi)
  - cd Ant-Media-Server-Common
  - mvn clean install -DskipTests -Dmaven.javadoc.skip=true -Dgpg.skip=true --quiet
  - cd ..


install:
  - mvn install -DskipTests=true -Dmaven.javadoc.skip=true -Dgpg.skip=true -B -V --quiet 

script:

cache:
  directories:
    - '$HOME/.m2/repository'

deploy:
  - provider: script
    script: "mvn deploy -P assemble -DskipTests --quiet --settings mvn-settings.xml"
    skip_cleanup: true
    on:
      tags: false
      branch: master
  
  - provider: script
    script: "mvn deploy -P assemble -DskipTests --quiet --settings mvn-settings.xml"
    skip_cleanup: true
    on:
      #deploy to maven if it is master branch and tagged
      tags: true
      branch: master
      
#above configuration prevents deploying a new release(not snapshot) if it is not tagged       
